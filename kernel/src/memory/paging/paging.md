# Paging

Paging is a memory management scheme that eliminates the need for contiguous allocation of physical memory, thereby avoiding problems like fragmentation. In a paging system, memory is divided into fixed-size units called pages, and corresponding units in physical memory are called frames. The key components and concepts involved in paging are:

1. Page: A fixed-length contiguous block of virtual memory.
2. Frame: A fixed-length block of physical memory, typically the same size as a page.
3. Page Table: A data structure used by the operating system to map virtual addresses to physical addresses.
4. Page Table Entry (PTE): Each entry in the page table, which contains information about a single page, such as the frame number and status bits.
5. Virtual Address: The address generated by the CPU, which consists of a page number and an offset within that page.
6. Physical Address: The actual location in physical memory where data is stored.
7. Translation Lookaside Buffer (TLB): A cache used to reduce the time taken to access the page table, storing recent translations of virtual addresses to physical addresses.
8. Page Fault: An event that occurs when a requested page is not in physical memory, requiring the operating system to fetch the page from disk.
9. Demand Paging: A type of paging where pages are loaded into memory only when they are needed.

## Paging workflow

1. The virtual address is divided into a page number and an offset.
2. The page number is used to index into the page table.
3. The page table entry provides the frame number where the page is stored.
4. The physical address is formed by combining the frame number with the offset.

# Paging with Page Directory (Multi Level Paging)

In a paged memory management system, especially on x86 architectures, a multi-level paging mechanism is used to efficiently manage large amounts of memory. The Page Directory is a critical part of this mechanism. Let’s break down the structure and function of a typical Page Directory in a system using two-level and multi-level paging.

## Two-Level Paging: Page Directory and Page Table
In two-level paging, virtual addresses are divided into multiple parts, typically including:

- Page Directory Index
- Page Table Index
- Offset


Here’s how the structure is generally organized:

### Page Directory Entry (PDE)
- Purpose: Points to a Page Table.
- Size: Typically 4 bytes (32 bits) in 32-bit systems.
- Fields:
    - Present (P): Indicates whether the page table is present in memory.
    - Read/Write (R/W): Indicates if the page is read-only or read/write.
    - User/Supervisor (U/S): Indicates if the page is accessible by all users or only by the supervisor (kernel).
    - Page Frame Address (PFA): The physical address of the page table (aligned to a 4 KB boundary).

### Page Table Entry (PTE)
- Purpose: Maps a virtual page to a physical frame.
- Size: Typically 4 bytes (32 bits) in 32-bit systems.
- Fields:
    - Present (P): Indicates whether the page is present in memory.
    - Read/Write (R/W): Indicates if the page is read-only or read/write.
    - User/Supervisor (U/S): Indicates if the page is accessible by all users or only by the supervisor.
    - Page Frame Address (PFA): The physical address of the frame where the page is stored (aligned to a 4 KB boundary).

## Multi-Level Paging: x86-64 Example (Four-Level Paging)
In modern x86-64 systems, four levels of paging are typically used, which include:

- Page Map Level 4 (PML4)
- Page Directory Pointer Table (PDPT)
- Page Directory (PD)
- Page Table (PT)
Each level points to the next, ultimately leading to the physical frame.

### Page Map Level 4 (PML4) Entry
Purpose: Points to a Page Directory Pointer Table.
Fields: Similar to PDE.

### Page Directory Pointer Table (PDPT) Entry
Purpose: Points to a Page Directory.
Fields: Similar to PDE.

### Page Directory (PD) Entry
Purpose: Points to a Page Table.
Fields: Similar to PDE.

### Page Table (PT) Entry
Purpose: Maps a virtual page to a physical frame.
Fields: Similar to PTE.

### Example Breakdown
For a 64-bit virtual address in a four-level paging system, the address is divided as follows:

1. PML4 Index (9 bits): Index into the PML4 table.
2. PDPT Index (9 bits): Index into the PDPT table.
3. PD Index (9 bits): Index into the PD table.
4. PT Index (9 bits): Index into the PT table.
5. Offset (12 bits): Offset within the 4 KB page.


## Requirements Two level paging implementation

1. pageDirectoryEntries = 1024
2. PageTableEntries = 1024
3. PageSize = 4096 bytes

4. PageTableSize = pageTableEntries * Pagesize = 1024 * 4096 = 4194304 bytes = 4096 KB = 4MB
5. PageDirectorySize = PageDirectoryEntries * PageTableSize = 1024 * 4MB = 4GB


